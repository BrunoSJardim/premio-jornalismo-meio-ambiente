{% extends 'trabalhos/base.html' %}

{% block title %}Avaliar Trabalhos{% endblock %}

{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
    <h2 class="mb-0">Meus trabalhos atribuídos — {{ tipo|title }}</h2>
    <div class="btn-group">
        <a class="btn btn-outline-primary {% if tipo == 'categoria' %}active{% endif %}"
            href="{% url 'painel_avaliador_tipo' 'categoria' %}">Categorias</a>
        <a class="btn btn-outline-primary {% if tipo == 'microtema' %}active{% endif %}"
            href="{% url 'painel_avaliador_tipo' 'microtema' %}">Microtemas</a>
    </div>
</div>

<table class="table table-striped align-middle">
    <thead class="table-light">
        <tr>
            <th style="width:46%">Título</th>
            <th style="width:24%">Situação</th>
            <th style="width:30%">Ação</th>
        </tr>
    </thead>
    <tbody>
        {% for a in atribuicoes %}
        <tr>
            <td>
                <div class="fw-semibold">{{ a.trabalho.titulo|default:"(Sem título)" }}</div>
                <div class="text-muted small">
                    {{ a.get_tipo_juri_display }} • ID #{{ a.trabalho_id }}
                </div>

                <!-- Resumo visível na lista -->
                {% if a.trabalho.descricao %}
                <div class="small mt-2">
                    {{ a.trabalho.descricao|truncatechars:180 }}
                </div>
                {% endif %}

                <div class="small mt-1">
                    {% if a.trabalho.link_trabalho %}
                    <a href="{{ a.trabalho.link_trabalho }}" target="_blank" rel="noopener">Abrir link</a>
                    {% endif %}
                    {% if a.trabalho.arquivo_trabalho %}
                    {% if a.trabalho.link_trabalho %} · {% endif %}
                    <a href="{{ a.trabalho.arquivo_trabalho.url }}" target="_blank" rel="noopener">Abrir arquivo</a>
                    {% endif %}
                </div>

            </td>

            <td>
                {% if a.avaliacao %}
                <span class="badge bg-success me-2">Avaliado</span>
                <div>Média ponderada: <strong>{{ a.avaliacao.media_ponderada }}</strong></div>
                <div>Decisão: {{ a.avaliacao.get_decisao_display }}</div>
                {% else %}
                <span class="badge bg-secondary">Pendente</span>
                {% endif %}
            </td>

            <td>
                <a class="btn btn-primary btn-sm" href="{% url 'avaliar_trabalho' a.id %}">
                    {% if a.avaliacao %}Editar parecer{% else %}Avaliar{% endif %}
                </a>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="3" class="text-center text-muted py-4">
                Nenhum trabalho atribuído para este tipo de júri.
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<style>
    /* Estéticos leves, pode remover se preferir usar só Bootstrap */
    .table td,
    .table th {
        vertical-align: middle;
    }
</style>
{% endblock %}